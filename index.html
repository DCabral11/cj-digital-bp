<!doctype html>
<html lang="pt-PT">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cartão de Jogo | BP 2026</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  </head>
  <body>
    <div class="bg-gradient"></div>
    <main class="app-shell">
      <section id="login-view" class="card visible" aria-hidden="false">
        <h1>Jogo de Cidade</h1>
        <p class="subtitle">Entrem na plataforma com as credenciais que me vos foram dadas no Posto Central</p>
        <form id="login-form" class="form-grid">
          <label>
            Username
            <input id="username" type="text" required placeholder="Ex: equipa01" />
          </label>
          <label>
            Password
            <input id="password" type="password" required placeholder="••••••••" />
          </label>
          <button type="submit">Entrar</button>
        </form>
        <p id="login-error" class="error"></p>
      </section>

      <section id="team-view" class="card hidden" hidden aria-hidden="true">
        <header class="view-header">
          <div>
            <h2 id="team-name">Equipa</h2>
            <p id="team-score" class="score-pill">Pontuação: 0</p>
          </div>
          <button id="logout-team" class="ghost">Terminar sessão</button>
        </header>
        <h3>Postos do jogo</h3>
        <p class="subtitle">Cliquem no posto em que se encontram e peçam ao chefe para colocar o PIN do jogo e pontuação!</p>
        <p class="subtitle">Verde = por jogar • Vermelho = já jogado (não podem voltar)</p>
        <div id="games-grid" class="games-grid"></div>
      </section>

      <section id="admin-view" class="card hidden" hidden aria-hidden="true">
        <header class="view-header">
          <h2>Painel de Administrador</h2>
          <div style="display:flex;gap:.6rem;flex-wrap:wrap;">
            <button id="export-admin-xlsx" class="primary-export">Exportar Dashboard Excel</button>
            <button id="logout-admin" class="ghost">Terminar sessão</button>
          </div>
        </header>

        <div class="panel-grid">
          <article>
            <h3>Ranking em tempo real</h3>
            <table>
              <thead>
                <tr><th>#</th><th>Equipa</th><th>Pontos</th></tr>
              </thead>
              <tbody id="ranking-body"></tbody>
            </table>
          </article>

          <article>
            <h3>Histórico de inserções</h3>
            <table>
              <thead>
                <tr><th>Data/Hora</th><th>Equipa</th><th>Jogo</th><th>Pontos</th></tr>
              </thead>
              <tbody id="history-body"></tbody>
            </table>
          </article>

        </div>

        <article class="access-card">
          <h3>Registo de acessos das contas</h3>
          <p class="subtitle" id="device-summary">A carregar registo de acessos...</p>
          <table>
            <thead>
              <tr><th>Data/Hora</th><th>Equipa</th><th>Dispositivo</th><th>Detalhe</th></tr>
            </thead>
            <tbody id="access-body"></tbody>
          </table>
        </article>
      </section>
    </main>

    <dialog id="pin-dialog">
      <form id="pin-form" class="form-grid">
        <h3 id="dialog-title">Validar posto</h3>
        <label>
          PIN do posto
          <input id="pin-input" type="password" required maxlength="8" autocomplete="off" />
        </label>
        <label>
          Pontos obtidos
          <select id="points-input" required>
            <option value="0">0</option>
            <option value="100" selected>100</option>
          </select>
        </label>
        <menu>
          <button id="cancel-pin" type="button" class="ghost cancel-btn">Cancelar</button>
          <button id="submit-pin" type="submit">Registar</button>
        </menu>
        <p id="pin-feedback" class="error"></p>
      </form>
    </dialog>

    <script>
      (function loadFirebaseConfig() {
        var script = document.createElement('script');
        script.src = '.env/firebase-config.js?v=16';
        document.head.appendChild(script);
      })();
    </script>
    <script type="module" src="app.js?v=14"></script>
  </body>
</html>





